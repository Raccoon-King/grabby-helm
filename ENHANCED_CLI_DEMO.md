# Enhanced CLI Workflow Demo

## üöÄ **New Interactive Experience**

### **Multi-Deployment Selection with Visual Health**
```
+==============================================================================+
|                                                                              |
|    ####  ####    #   #### #### #   #     #   # ##### #     #   #            |
|   #     #   #   # #  #  # #  # #   #     #   # #     #     ## ##            |
|   # ##  ####   #####  ### ####  ###  --- ##### ####  #     # # #            |
|   #  #  # #    #   # #  # #  #   #       #   # #     #     #   #            |
|    ###  #  #   #   # #### ####   #       #   # ##### ##### #   #            |
|                                                                              |
|                         Kubernetes to Helm Chart Exporter                   |
|                                                                              |
|                     Transform your K8s workloads into                       |
|                        reusable Helm charts instantly!                      |
|                                                                              |
+==============================================================================+

>> Interactive Configuration
==================================================

Configuration options:
  1. Auto-discover from deployments (recommended)
  2. Manual configuration

Select option [1-2]: 1

Kubernetes namespace to scan for deployments [default]: production

Scanning for deployments in namespace 'production'...

Found 5 deployment(s):
--------------------------------------------------------------------------------
Sel  #   Name                 Status     Replicas Images
--------------------------------------------------------------------------------
[ ]  1   api-service          ‚úÖ Ready    3/3      myregistry/api:v2.1.0
[ ]  2   frontend-app         ‚ö†Ô∏è Issue    1/2      nginx:1.21, myapp/ui:v1.5.2
[ ]  3   background-worker    ‚úÖ Ready    1/1      myapp/worker:v3.0.1
[ ]  4   notification-service üîÑ Scaling  2/5      myapp/notifications:v1.2.0
[ ]  5   user-management      ‚ùå Failed   0/3      myapp/users:v2.5.0
--------------------------------------------------------------------------------

Multi-Selection Commands:
  [number]  - Toggle selection (e.g., '1', '3')
  'a'       - Select all
  'n'       - Select none
  'done'    - Confirm selection
  'q'       - Quit

Command: 1
Selected: api-service

Command: 2
Selected: frontend-app

Command: done

Selected 2 deployment(s):
  - api-service
  - frontend-app

Selected deployments: api-service, frontend-app
For multiple deployments, you can:
  1. Use a common label selector (e.g., 'team=frontend')
  2. Leave empty to include all resources for selected deployments

Helm chart name for combined deployments [multi-app]: frontend-stack
Output directory [./frontend-stack-chart]:
Label selector (optional for multi-deployment) []: app=frontend

üîç Scanning for related resources...

Found 8 potentially related resources:

üì¶ Configmaps:
  1. frontend-config
  2. api-config
  3. nginx-config

Include all 3 configmaps? [Y/n]: y

üì¶ Secrets:
  1. api-keys
  2. database-credentials

Include all 2 secrets? [Y/n]: y
‚úÖ Enabled secret inclusion due to discovered dependencies

üì¶ Services:
  1. api-service
  2. frontend-service

Include all 2 services? [Y/n]: y

üì¶ Persistentvolumeclaims:
  1. api-storage

Include all 1 persistentvolumeclaims? [Y/n]: y

Configure advanced options? [y/N]: n
Create test chart alongside main chart? [y/N]: y
Test suffix [test]:
Run helm lint after generation? [Y/n]:
Overwrite output directory if it exists? [y/N]: y
Save this configuration for future use? [Y/n]: y
Configuration name [config-20250919-1420]: frontend-stack-config

Configuration saved: frontend-stack-config

Creating Helm chart 'frontend-stack'...
‚úÖ Chart 'frontend-stack' created successfully!

Would you like to create another chart from a different deployment? [y/N]: n

üéâ Successfully created 1 Helm chart(s):
  - frontend-stack

You can now package and deploy these charts:
  helm package ./frontend-stack-chart
  helm install frontend-stack ./frontend-stack-chart
```

## üéØ **Generated Chart with Templating**

### **Chart.yaml** (Enhanced)
```yaml
apiVersion: v2
name: frontend-stack
description: Helm chart with Deployment, Service, ConfigMap, Secret, PersistentVolumeClaim exported from Kubernetes
type: application
version: 0.1.0
appVersion: "v2.1.0"  # Extracted from api-service image tag
```

### **values.yaml** (Smart Extraction)
```yaml
# Values file generated by rancher-helm-exporter
# Extracted from live Kubernetes resources

# From api-service deployment
image:
  repository: myregistry/api
  tag: v2.1.0
  pullPolicy: IfNotPresent

replicaCount: 3

env:
  dbhost: production-db.company.com
  dbport: "5432"
  loglevel: info

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi

# From frontend-app deployment
frontend:
  image:
    repository: myapp/ui
    tag: v1.5.2
  replicaCount: 2

# From services
service:
  type: LoadBalancer
  port: 80
  targetPort: 8080

# From ConfigMaps
config:
  frontend_config:
    enabled: true
    data:
      nginx.conf: |
        server { ... }
  api_config:
    enabled: true
    data:
      app.properties: |
        database.host=${DB_HOST}

# From Secrets
secrets:
  api_keys:
    enabled: true
    data:
      # References to actual secret values

# From PVCs
persistence:
  api_storage:
    enabled: true
    size: 100Gi
    storageClass: fast-ssd
    accessMode: ReadWriteOnce
```

### **templates/deployments-api-service.yaml** (Templated)
```yaml
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-service
  labels:
    app: api-service
spec:
  replicas: {{ .Values.replicaCount | default 1 }}
  selector:
    matchLabels:
      app: api-service
  template:
    metadata:
      labels:
        app: api-service
    spec:
      containers:
      - name: api
        image: {{ .Values.image.repository }}:{{ .Values.image.tag }}
        imagePullPolicy: {{ .Values.image.pullPolicy }}
        resources: {{ toYaml .Values.resources | nindent 12 }}
        env:
        - name: DB_HOST
          value: {{ .Values.env.dbhost | default "localhost" }}
        - name: DB_PORT
          value: {{ .Values.env.dbport | default "5432" }}
        - name: LOG_LEVEL
          value: {{ .Values.env.loglevel | default "info" }}
```

## ‚ú® **Key Improvements Implemented**

### **1. Multi-Deployment Selection ‚úÖ**
- Checkbox interface with toggle commands
- Visual selection indicators `[‚úì]` and `[ ]`
- Support for single or multiple deployment charts
- Select all/none shortcuts

### **2. Visual Health Status ‚úÖ**
- `‚úÖ Ready` - All replicas running
- `‚ö†Ô∏è Issue` - Some replicas down
- `‚ùå Failed` - No replicas running
- `üîÑ Scaling` - Scaling in progress
- `‚ö™ Stopped` - Zero replicas

### **3. Smart Chart Templating ‚úÖ**
- `{{ .Values.replicaCount }}` for replica counts
- `{{ .Values.image.repository }}:{{ .Values.image.tag }}` for images
- `{{ toYaml .Values.resources | nindent 12 }}` for resources
- `{{ .Values.env.* }}` for environment variables
- Service ports, ConfigMap data, Secret references

### **4. Intelligent Dependency Detection ‚úÖ**
- Auto-scans namespace for related resources
- Matches by name patterns and labels
- Interactive selection of discovered dependencies
- Automatically enables secret inclusion when needed

## üöÄ **Production Benefits**

### **Before Enhancement**:
- Manual single deployment selection
- Static values in manifests
- No dependency discovery
- Generic Chart.yaml and values.yaml

### **After Enhancement**:
- ‚úÖ **Multi-deployment workflows** - Complete application stacks
- ‚úÖ **Production-ready templates** - `{{ .Values.* }}` everywhere
- ‚úÖ **Smart dependency detection** - No missing resources
- ‚úÖ **Visual deployment health** - Make informed selections
- ‚úÖ **Extracted real values** - Actual production configuration

**This transforms Grabby-Helm from a simple export tool into a comprehensive Kubernetes-to-Helm migration platform!**